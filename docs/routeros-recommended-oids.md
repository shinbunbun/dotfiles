# RouterOS 推奨監視OIDリスト

## 概要
RouterOSから取得可能な940個のOIDから、実際の監視に有用なOIDを選定しました。
現在のルーター構成とシステム状況を考慮して、優先度別に分類しています。

## 現在のルーター構成
- モデル: RB962UiGS-5HacT2HnT (hAP ac)
- インターフェース構成:
  - 物理: ether1-5, sfp1, wlan1, wlan2
  - 論理: bridge, pppoe-out1, wg-home (WireGuard)
- 機能: DHCP, SNMP, WireGuard VPN, PPPoE
- 特記: PoE対応(ether5), ディスク無し

## 優先度1: 必須監視項目

### 1. ハードウェアモニター
システムの健全性を監視する最重要項目です。

| OID | 説明 | 現在値 | 推奨閾値 |
|-----|------|--------|----------|
| 1.3.6.1.4.1.14988.1.1.3.10.0 | CPU温度 | 44°C | アラート: >70°C |
| 1.3.6.1.4.1.14988.1.1.3.8.0 | 電源電圧 | 24.3V | アラート: <20V or >28V |
| 1.3.6.1.4.1.14988.1.1.3.14.0 | CPU周波数 | 720MHz | 情報表示用 |
| 1.3.6.1.4.1.14988.1.1.3.100.1.3.14 | 温度センサー詳細 | 44°C | 冗長監視用 |
| 1.3.6.1.4.1.14988.1.1.3.100.1.3.13 | 電圧センサー詳細 | 24.3V | 冗長監視用 |

### 2. システム基本情報
システム識別と状態把握に必須です。

| OID | 説明 | 値の例 | 用途 |
|-----|------|--------|------|
| 1.3.6.1.4.1.14988.1.1.7.8.0 | ボード名 | "hAP ac" | デバイス識別 |
| 1.3.6.1.4.1.14988.1.1.7.9.0 | モデル名 | "RB962UiGS-5HacT2HnT" | デバイス識別 |
| 1.3.6.1.4.1.14988.1.1.4.4.0 | 現在のバージョン | "7.19.2" | バージョン管理 |
| 1.3.6.1.4.1.14988.1.1.7.7.0 | 利用可能アップグレード | "7.19.2" | アップデート通知 |
| 1.3.6.1.4.1.14988.1.1.7.3.0 | シリアル番号 | "BEC50BE416D7" | 資産管理 |

### 3. インターフェース基本統計
最も重要なトラフィック監視項目です。

#### 主要インターフェース（ether1, pppoe-out1, bridge, wg-home）に対して:

| OID | 説明 | データ型 | 監視目的 |
|-----|------|----------|----------|
| 1.3.6.1.4.1.14988.1.1.14.1.1.11.x | 受信バイト数 | Counter64 | 帯域使用率 |
| 1.3.6.1.4.1.14988.1.1.14.1.1.13.x | 送信バイト数 | Counter64 | 帯域使用率 |
| 1.3.6.1.4.1.14988.1.1.14.1.1.15.x | 受信エラー数 | Counter64 | エラー率監視 |
| 1.3.6.1.4.1.14988.1.1.14.1.1.16.x | 送信エラー数 | Counter64 | エラー率監視 |

インターフェースインデックス:
- 1: ether1 (LAN)
- 9: bridge
- 10: pppoe-out1 (WAN)
- 12: wg-home (VPN)

### 4. システムヘルス
障害予兆の検知に重要です。

| OID | 説明 | 用途 |
|-----|------|------|
| 1.3.6.1.4.1.14988.1.1.13.10.0 | システム再起動回数 | 安定性監視 |
| 1.3.6.1.4.1.14988.1.1.13.11.0 | 不良ブロック数 | メモリ健全性 |
| 1.3.6.1.4.1.14988.1.1.13.12.0 | USB電源リセット回数 | 電源安定性 |

## 優先度2: 推奨監視項目

### 5. DHCP情報
ネットワーク使用状況の把握に有用です。

| OID | 説明 | 現在値 | 監視目的 |
|-----|------|--------|----------|
| 1.3.6.1.4.1.14988.1.1.6.1.0 | アクティブDHCPリース数 | 14 | 接続デバイス数監視 |

### 6. 詳細インターフェース統計
より詳細なトラフィック分析が必要な場合に使用します。

| OID | 説明 | 用途 |
|-----|------|------|
| 1.3.6.1.4.1.14988.1.1.14.1.1.17.x | 受信ドロップ数 | パケットロス分析 |
| 1.3.6.1.4.1.14988.1.1.14.1.1.18.x | 送信ドロップ数 | パケットロス分析 |
| 1.3.6.1.4.1.14988.1.1.14.1.1.31-35.x | フレームサイズ別統計 | トラフィック特性分析 |

### 7. WireGuard VPN統計（注：RouterOSはSNMP経由でWireGuard固有の統計を提供していません）
VPN使用状況の監視に有用です。

| OID | 説明 | 監視対象 |
|-----|------|----------|
| 1.3.6.1.4.1.14988.1.1.19.1.1.4.6 | 受信バイト数 | VPNトラフィック |
| 1.3.6.1.4.1.14988.1.1.19.1.1.5.6 | 送信バイト数 | VPNトラフィック |
| 1.3.6.1.4.1.14988.1.1.19.1.1.6.6 | 最終ハンドシェイク | 接続状態 |

### 8. PoE情報（ether5のみ）
PoEデバイスを使用する場合に監視します。

| OID | 説明 | 現在値 |
|-----|------|--------|
| 1.3.6.1.4.1.14988.1.1.15.1.1.3.5 | PoE状態 | 2 (無効) |
| 1.3.6.1.4.1.14988.1.1.15.1.1.4.5 | PoE電圧(mV) | 0 |
| 1.3.6.1.4.1.14988.1.1.15.1.1.5.5 | PoE電流(mA) | 0 |
| 1.3.6.1.4.1.14988.1.1.15.1.1.6.5 | PoE電力(mW) | 0 |

## 優先度3: オプション監視項目

### 9. パーティション情報
ファームウェア管理に有用です。

| OID | 説明 | 値 |
|-----|------|-----|
| 1.3.6.1.4.1.14988.1.1.17.1.1.4.1 | パーティションバージョン | "RouterOS v7.19.2" |
| 1.3.6.1.4.1.14988.1.1.17.1.1.5.1 | アクティブ状態 | 1 (アクティブ) |

### 10. 無線インターフェース統計
無線ネットワークの詳細分析が必要な場合に使用します。

wlan1 (2.4GHz) とwlan2 (5GHz) のインデックス7,8に対して、
基本統計に加えて以下を監視:

| OID | 説明 | 用途 |
|-----|------|------|
| 1.3.6.1.4.1.14988.1.1.14.1.1.61-65.x | 無線固有統計 | 無線品質分析 |

## 実装推奨事項

### 1. 段階的実装
1. **第1段階**: 優先度1の項目をすべて実装
2. **第2段階**: DHCPリース数を追加
3. **第3段階**: 必要に応じて詳細統計を追加

### 2. 監視間隔
- ハードウェアモニター: 1分
- インターフェース統計: 30秒
- システム情報: 5分
- DHCP情報: 1分

### 3. アラート設定例
```yaml
# 温度アラート
- alert: RouterOSHighTemperature
  expr: routeros_temperature > 70
  annotations:
    summary: "RouterOS温度が高すぎます ({{ $value }}°C)"

# エラー率アラート  
- alert: RouterOSHighErrorRate
  expr: rate(routeros_interface_rx_errors[5m]) > 100
  annotations:
    summary: "インターフェース{{ $labels.interface }}のエラー率が高い"

# 再起動検知
- alert: RouterOSRestarted
  expr: increase(routeros_reboot_count[1h]) > 0
  annotations:
    summary: "RouterOSが再起動しました"
```

### 4. 現在未実装で追加すべきOID

以下のOIDは現在のSNMP設定（`/home/bunbun/dotfiles/cells/core/nixosProfiles/snmp.yml`）に
含まれていないが、監視に有用なため追加を推奨:

1. **システムヘルス関連**
   - 1.3.6.1.4.1.14988.1.1.13.10.0 (再起動回数)
   - 1.3.6.1.4.1.14988.1.1.13.11.0 (不良ブロック数)
   - 1.3.6.1.4.1.14988.1.1.13.12.0 (USB電源リセット)

2. **DHCP監視**
   - 1.3.6.1.4.1.14988.1.1.6.1.0 (アクティブリース数)

3. **VPN監視**
   - WireGuardは標準のインターフェース統計（ifInOctets/ifOutOctets）で監視

4. **バージョン管理**
   - 1.3.6.1.4.1.14988.1.1.7.7.0 (利用可能アップグレード)

## まとめ

940個のOIDから実用的な監視に必要な約40個のOIDを選定しました。
これらのOIDを実装することで、RouterOSの状態を効果的に監視できます。

特に重要なのは:
- ハードウェア温度と電圧の監視（故障予防）
- インターフェースエラー率の監視（ネットワーク品質）
- システム再起動回数の監視（安定性）
- DHCP接続数の監視（使用状況把握）

これらの監視により、問題の早期発見と予防的メンテナンスが可能になります。