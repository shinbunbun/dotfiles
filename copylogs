#!/bin/bash
# copylogs - ビルド結果ログ・成果物のコピー例
# 必要に応じて、ログファイルや成果物のパスは修正してください。

set -euo pipefail

# コピー先ディレクトリ（例: logs）を作成
LOGS_DIR="logs"
mkdir -p "$LOGS_DIR"

echo "=== Build Log & Artifacts Copy Start ==="

# 例1: ビルドの標準出力ログが build.log に出力されている場合のコピー
if [ -f build.log ]; then
    cp build.log "$LOGS_DIR/"
    echo "Copied build.log to $LOGS_DIR/"
else
    echo "build.log not found."
fi

# 例2: Nix の --out-link により作成された 'result' シンボリックリンクの存在チェック
if [ -L result ] || [ -d result ]; then
    # シンボリックリンク先の中身をコピーする（またはシンボリックリンク自体をコピーする場合は -P オプションを利用）
    cp -R result "$LOGS_DIR/"
    echo "Copied build result (result) to $LOGS_DIR/result"
else
    echo "No 'result' directory or symlink found."
fi

# その他、必要な成果物のコピー例（例: cells ディレクトリ内の特定ファイルなど）
if [ -d cells ]; then
    cp -R cells "$LOGS_DIR/"
    echo "Copied 'cells' directory to $LOGS_DIR/cells"
fi

# 最終的なディレクトリ構成を表示
echo "Contents of $LOGS_DIR:"
ls -lah "$LOGS_DIR"

echo "=== Build Log & Artifacts Copy Completed ==="
exit 0
